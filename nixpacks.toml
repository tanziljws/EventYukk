[phases.setup]
nixPkgs = ['nodejs-20_x']

[providers]
node = "20"

[variables]
NPM_CONFIG_IGNORE_SCRIPTS = "true"
NODE_VERSION = "20"

[phases.install]
cmds = [
  'export NPM_CONFIG_IGNORE_SCRIPTS=true',
  'npm config set ignore-scripts true',
  'npm ci --ignore-scripts || true',
  '(cd frontend && npm ci --ignore-scripts) || true',
  '(cd server && npm ci --ignore-scripts) || true'
]

[phases.build]
cmds = [
  'cd frontend && npm run build || echo "Build skipped"',
  'echo "Build phase complete"'
]

[start]
cmd = 'cd server && NODE_ENV=production node server.js'
