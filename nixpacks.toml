[phases.setup]
nixPkgs = ['nodejs-20_x']

[variables]
NODE_VERSION = "20"

[phases.install]
cmds = [
  'npm ci --ignore-scripts',
  '(cd frontend && npm ci)',
  '(cd server && npm ci --ignore-scripts)'
]

[phases.build]
cmds = [
  'npm run build',
  'echo "Frontend build complete"'
]

[start]
cmd = 'cd server && NODE_ENV=production node server.js'
